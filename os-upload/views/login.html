{% extends "base.html" %}

{% block content %}
<div class="alert alert-warning">
  You haven't yet told us your OpenSpending API Key. You'll need to do that before we can do any uploading.
</div>

<h3>Paste your API Key Here</h3>
<form action="" method="POST" class="form">
  <input
    type="text"
    name="apikey"
    class="span6 js-apikey"
    required=""
    />
  <span class="checking" style="display: none;"><i class="fa fa-spinner fa-spin"></i> Checking ...</span>
  <br />
  <button type="submit" class="btn btn-disabled">Save my API Key</button>
</form>

<p>Your API Key is in your <a href="http://openspending.org/settings">OpenSpending settings page</a> (near the bottom).</p>

<p>We've opened your settings page in an iframe below. Note if you are <strong>not</strong> logged in to OpenSpending you'll get an access denied error!</p>

<h3>Your Settings Page</h3>
<iframe src="https://openspending.org/settings" width="100%" height="600"></iframe>

<!--
TODO: re-enable once OS CORS supports Authorization Header
<script type="text/javascript">
jQuery(document).ready(function($) {
  var apikey = $('.js-apikey').val();
  $('.js-apikey').on('change paste keyup', function(e) {
    $('.checking').show();
    $.ajax({
      url: 'https://openspending.org/api/2/permissions',
      headers: {
        Authorization: 'ApiKey ' + apikey
      },
      data: { 
        dataset: 'this-dataset-does-not-exist'
      },
      success: function(data) {
        console.log(data);
      }
    });
  });
});
</script>
-->
{% endblock %}

